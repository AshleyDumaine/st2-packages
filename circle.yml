version: 2
executorType: machine
stages:
  build:
    parallel: 1
    workDir: ~/st2-packages
    environment:
      - DISTROS: trusty xenial el6 el7 wheezy jessie
    steps:
      - type: checkout
      - type: shell
        name: Show Docker versions
        command: |
          docker --version
          docker-compose --version
      - type: shell
        name: Initialize Build Environment
        command: |
          .circle/buildenv_st2.sh
      - type: shell
        name: Pull Images
        command: |
          .circle/docker-compose.sh pull ${DISTRO}
      - type: shell
        name: Build Packages
        command: |
          .circle/docker-compose.sh build ${DISTRO}
      - type: shell
        name: Test Packages
        command: |
          .circle/docker-compose.sh test ${DISTRO}
